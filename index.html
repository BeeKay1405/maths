<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <title>Our Math-Heart</title>
  <link rel="stylesheet" href="style.css"/>
  <!-- p5.js library -->
  <script src="https://cdn.jsdelivr.net/npm/p5@1.6.0/lib/p5.min.js"></script>
</head>
<body>
  <!-- Intro Screen -->
  <div id="intro-screen">
    <h1>Welcome to Our Math-Heart</h1>
    <p>[Your intro text here]</p>
    <button id="start-btn">Let's Go!</button>
  </div>

  <!-- Main App (hidden until start) -->
  <div id="app" class="hidden">
    <h1>Unlock Our Love Equation</h1>

    <!-- Question area -->
    <div id="question">Q1: [Your romantic prompt here]</div>

    <!-- Button-based input panel -->
    <div id="input-panel">
      <div class="button-row">
        <button class="sym-btn">x</button>
        <button class="sym-btn">y</button>
        <button class="sym-btn">^</button>
        <button class="sym-btn">2</button>
        <button class="sym-btn">3</button>
      </div>
      <div class="button-row">
        <button class="sym-btn">+</button>
        <button class="sym-btn">-</button>
        <button class="sym-btn">(</button>
        <button class="sym-btn">)</button>
      </div>
      <div class="button-row">
        <button id="clear-btn">Clear</button>
        <button id="delete-btn">Delete</button>
        <button id="submit-btn">Submit</button>
        <button id="plot-btn">Plot It</button>
      </div>
      <div id="answer-display"></div>
    </div>

    <!-- Plotting area -->
    <div id="canvas-container"></div>
  </div>

  <script>
    // Elements
    const introScreen = document.getElementById('intro-screen');
    const appDiv      = document.getElementById('app');
    const startBtn    = document.getElementById('start-btn');

    // Start app
    startBtn.addEventListener('click', () => {
      introScreen.classList.add('hidden');
      appDiv.classList.remove('hidden');
      // initial canvas redraw
      setTimeout(() => p5Instance.redraw(), 100);
    });

    // --- Puzzle Logic ---
    const rawAnswers = ["(x^2 + y^2 - 1)", "3", "- x2y3"];
    const prompts    = [
      "Q1: â€¦answer is (xÂ²+yÂ²â€“1)â€¦",
      "Q2: â€¦answer is 3â€¦",
      "Q3: â€¦answer is - x2y3â€¦",
    ];
    let stage = 0;
    let currentInput = '';
    let plotReady = false;

    function sanitize(str, stage) {
      let s = str.replace(/\s+/g, '');
      if (stage === 0) s = s.replace(/[()]/g, '');
      return s;
    }
    const answers = rawAnswers.map((ans,i) => sanitize(ans,i));

    const displayEl = document.getElementById('answer-display');
    function refreshDisplay() {
      displayEl.innerText = currentInput || 'Click buttons to build answer';
    }

    document.querySelectorAll('.sym-btn').forEach(btn => btn.addEventListener('click', ()=>{
      currentInput += btn.innerText;
      refreshDisplay();
    }));

    document.getElementById('clear-btn').addEventListener('click', ()=>{
      currentInput = '';
      refreshDisplay();
    });
    document.getElementById('delete-btn').addEventListener('click', ()=>{
      currentInput = currentInput.slice(0,-1);
      refreshDisplay();
    });
    document.getElementById('submit-btn').addEventListener('click', ()=>{
      if (sanitize(currentInput,stage) === answers[stage]) {
        stage++;
        currentInput = '';
        if (stage < prompts.length) {
          document.getElementById('question').innerText = prompts[stage];
        } else {
          document.getElementById('question').innerHTML = 'ðŸ’– Love Unlocked! ðŸ’–';
          document.getElementById('plot-btn').style.display='inline-block';
        }
      } else {
        document.getElementById('question').innerText = 'Try again! ' + prompts[stage];
      }
      refreshDisplay();
    });

    document.getElementById('plot-btn').addEventListener('click', ()=>{
      plotReady = true;
      p5Instance.redraw();
    });

    // --- p5 Sketch ---
    let p5Instance;
    const sketch = p => {
      p.setup = ()=>{
        const container = document.getElementById('canvas-container');
        const cnv = p.createCanvas(400,400);
        cnv.parent(container);
        p.noLoop();
      };
      p.draw = ()=>{
        p.clear(); p.translate(p.width/2,p.height/2); p.stroke(200,0,80); p.noFill();
        if (!plotReady) {
          if (stage===1) p.text(rawAnswers[0],0,0);
          else if(stage===2) p.text(rawAnswers[1],0,0);
        } else {
          p.beginShape();
          for(let a=0;a<p.TWO_PI;a+=0.01){
            let x=16*Math.pow(Math.sin(a),3);
            let y=13*Math.cos(a)-5*Math.cos(2*a)-2*Math.cos(3*a)-Math.cos(4*a);
            p.vertex(x*10,-y*10);
          }
          p.endShape(p.CLOSE);
        }
      };
      p5Instance = p;
    };
    new p5(sketch);
  </script>
</body>
</html>